# 過去の記録を一括追加する機能 - To-Do List

## 機能概要
過去の日付に対して、プランと実績時間を一括で追加できる機能を実装します。
- 初期表示: 5行の入力欄
- 追加ボタン: 自由な個数の行を追加可能
- フォーマット: 日付 (MM/DD/YYYY) | プラン時間 (HH:MM) | 実績時間 (HH:MM)

## 実装タスク

### Phase 1: コンポーネント設計と基本構造

#### 1.1 コンポーネントファイルの作成
- [ ] `components/BulkRecordAdd.tsx` を作成
- [ ] TypeScriptインターフェースを定義
  - `BulkRecordRow`: 1行分のデータ構造
    - `date: string` (MM/DD/YYYY形式)
    - `planHours: string`
    - `planMinutes: string`
    - `actualHours: string`
    - `actualMinutes: string`

#### 1.2 状態管理の実装
- [ ] 初期状態: 5行の空データ配列
- [ ] 行の追加/削除機能
- [ ] 各行の入力値管理

### Phase 2: UI実装

#### 2.1 テーブル形式の入力UI
- [ ] ヘッダー行の作成
  - "Date" | "Plan" | "Actual Time"
- [ ] 入力行の実装
  - 日付入力フィールド (MM/DD/YYYY形式)
  - プラン時間入力 (Hours:Minutes)
  - 実績時間入力 (Hours:Minutes)
- [ ] 各行に削除ボタンを追加

#### 2.2 行の追加機能
- [ ] "+ Add Row" ボタンの実装
- [ ] クリックで1行追加
- [ ] 複数行を一度に追加できる機能（オプション）

#### 2.3 バリデーション
- [ ] 日付形式の検証 (MM/DD/YYYY)
- [ ] 時間形式の検証 (HH:MM, 0-23時間, 0-59分)
- [ ] 必須項目のチェック
- [ ] エラーメッセージの表示

### Phase 3: データ変換と保存

#### 3.1 日付形式の変換
- [ ] MM/DD/YYYY → YYYY-MM-DD 変換関数
- [ ] 日付の妥当性チェック
- [ ] エラーハンドリング

#### 3.2 時間形式の変換
- [ ] HH:MM → hours/minutes 変換関数
- [ ] 時間の妥当性チェック

#### 3.3 データ保存処理
- [ ] 各行を `PlanData` と `StudyRecord` に変換
- [ ] 既存データとのマージ処理
  - 同じ日付のプランがある場合: 上書き
  - 同じ日付の記録がある場合: 累積 or 上書き（要確認）
- [ ] 一括保存機能
- [ ] 保存成功/失敗のフィードバック

### Phase 4: UI/UX改善

#### 4.1 モーダル/パネル実装
- [ ] モーダルまたは展開可能なパネルとして実装
- [ ] 開閉アニメーション
- [ ] 背景クリックで閉じる機能
- [ ] Escapeキーで閉じる機能

#### 4.2 入力の使いやすさ
- [ ] 日付入力の自動フォーマット（スラッシュ挿入）
- [ ] 時間入力の自動フォーマット（コロン挿入）
- [ ] Tabキーで次のフィールドに移動
- [ ] Enterキーで次の行に移動（オプション）

#### 4.3 プレビュー機能
- [ ] 保存前にデータのプレビュー表示
- [ ] 追加される件数の表示

### Phase 5: エラーハンドリングとバリデーション

#### 5.1 入力検証
- [ ] 日付の妥当性（存在する日付か）
- [ ] 日付範囲のチェック（未来の日付は警告）
- [ ] 時間の範囲チェック（0-23時間、0-59分）
- [ ] 必須項目のチェック

#### 5.2 エラー表示
- [ ] 行ごとのエラー表示
- [ ] エラーがある行のハイライト
- [ ] 保存前の全行チェック

#### 5.3 成功/失敗フィードバック
- [ ] 保存成功時のトースト/メッセージ
- [ ] 保存失敗時のエラーメッセージ
- [ ] 保存件数の表示

### Phase 6: 統合とテスト

#### 6.1 メインページへの統合
- [ ] `app/page.tsx` にコンポーネントを追加
- [ ] 設定パネルまたは専用ボタンからアクセス
- [ ] 状態管理の統合

#### 6.2 ダークモード対応
- [ ] すべてのUI要素にダークモードクラスを追加
- [ ] 入力フィールドのダークモード対応

#### 6.3 アクセシビリティ
- [ ] ARIA属性の追加
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応

### Phase 7: 最適化と改善

#### 7.1 パフォーマンス
- [ ] 大量の行がある場合のパフォーマンス最適化
- [ ] 仮想スクロールの検討（100行以上の場合）

#### 7.2 追加機能（オプション）
- [ ] CSVからの一括インポート
- [ ] テンプレート機能（よく使うパターンの保存）
- [ ] 行の並び替え機能
- [ ] 一括削除機能

## 技術的な詳細

### データ構造
```typescript
interface BulkRecordRow {
  date: string;        // MM/DD/YYYY形式
  planHours: string;   // "00" - "23"
  planMinutes: string; // "00" - "59"
  actualHours: string; // "00" - "23"
  actualMinutes: string; // "00" - "59"
}
```

### 変換処理
1. 日付: `MM/DD/YYYY` → `YYYY-MM-DD`
2. プラン: `HH:MM` → `{ hours: number, minutes: number }`
3. 実績: `HH:MM` → `minutes: number` (合計分数)

### バリデーションルール
- 日付: MM/DD/YYYY形式、有効な日付、未来の日付は警告
- 時間: HH:MM形式、0-23時間、0-59分
- 必須: 日付は必須、プランと実績は少なくとも一方が必須

## 実装の優先順位

### 最優先（MVP）
1. 基本UI（5行の入力欄）
2. 行の追加機能
3. データ変換と保存
4. 基本的なバリデーション

### 高優先度
5. エラーハンドリング
6. モーダル/パネル実装
7. ダークモード対応

### 中優先度
8. 入力の自動フォーマット
9. プレビュー機能
10. アクセシビリティ改善

### 低優先度（将来の拡張）
11. CSVインポート
12. テンプレート機能
13. パフォーマンス最適化

